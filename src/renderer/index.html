<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magic English</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <div class="title-bar">
        <nav class="tab-bar">
          <div class="tab-list">
            <button class="tab active" data-tab="vocab">
              <span class="tab-icon">+</span>
              <span class="tab-label">Magic Vocab</span>
            </button>
            <button class="tab" data-tab="scoring">
              <span class="tab-icon">+</span>
              <span class="tab-label">Rate Sentence</span>
            </button>
            <button class="tab" data-tab="profile">
              <span class="tab-icon">+</span>
              <span class="tab-label">Stats & Streaks</span>
            </button>
          </div>
        </nav>
        <div class="title-bar-actions">
          <button id="magic-search-btn" class="title-bar-btn" title="Magic Search (Ctrl+K)">
            üîç
          </button>
          <button id="settings-btn" class="title-bar-btn" title="C√†i ƒë·∫∑t">
            ‚öôÔ∏è
          </button>
          <button id="window-minimize" class="title-bar-btn window-control" title="Thu nh·ªè">
            <span class="window-control-icon window-control-minimize"></span>
          </button>
          <button id="window-maximize" class="title-bar-btn window-control" title="Ph√≥ng to">
            <span class="window-control-icon window-control-maximize"></span>
          </button>
          <button id="window-close" class="title-bar-btn window-control window-control-close" title="ƒê√≥ng">
            <span class="window-control-icon window-control-close-icon"></span>
          </button>
        </div>
      </div>

      <div class="tab-content active" data-tab="vocab">
        <div class="app-content">
        <aside class="left-pane">
        <section class="card search-card">
          <header class="card__header">
            <h2 data-i18n="vocab.search.title">T√¨m t·ª´ nhanh</h2>
            <p class="card__subtitle" data-i18n="vocab.search.subtitle">AI s·∫Ω t·ª± l∆∞u k·∫øt qu·∫£ v√†o database ƒëang ch·ªçn</p>
          </header>
          <div class="search-card__input">
            <input
              id="word-search-input"
              type="text"
              placeholder="Nh·∫≠p t·ª´ v·ª±ng ti·∫øng Anh..."
              autocomplete="off"
            />
            <button id="word-search-btn" type="button" class="primary-btn icon-only" title="Search">üîç</button>
          </div>
        </section>

        <section class="card ai-card">
          <header class="card__header">
            <h2 data-i18n="vocab.aiResult.title">K·∫øt qu·∫£ AI</h2>
          </header>
          <div id="ai-output" class="ai-output">
            <p class="muted" data-i18n="vocab.aiResult.empty">Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o. H√£y t√¨m m·ªôt t·ª´ ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
          </div>
        </section>

      </aside>

      <section class="right-pane">
        <section class="card db-card">
          <header class="card__header db-card__header">
            <div>
              <h2 data-i18n="vocab.database.title">Qu·∫£n l√Ω Database</h2>
              <p class="card__subtitle" data-i18n="vocab.database.subtitle">Ch·ªçn th∆∞ m·ª•c pin v√† qu·∫£n l√Ω c√°c file t·ª´ v·ª±ng</p>
            </div>
            <div class="db-actions">
              <select id="path-select" title="Ch·ªçn th∆∞ m·ª•c JSON"></select>
              <button id="path-pin" type="button" class="ghost-btn icon-only" data-i18n-title="vocab.paths.pin" title="Pin th∆∞ m·ª•c m·ªõi">üìå</button>
              <button id="path-remove" type="button" class="ghost-btn icon-only" data-i18n-title="vocab.paths.remove" title="B·ªè pin th∆∞ m·ª•c">‚ùå</button>
              <button id="db-new" type="button" class="ghost-btn icon-only" data-i18n-title="vocab.database.new" title="T·∫°o DB m·ªõi">‚ûï</button>
              <button id="db-rename" type="button" class="ghost-btn icon-only" data-i18n-title="vocab.database.rename" title="ƒê·ªïi t√™n DB">‚úèÔ∏è</button>
              <button id="db-delete" type="button" class="ghost-btn icon-only" data-i18n-title="vocab.database.delete" title="Xo√° DB">üóëÔ∏è</button>
            </div>
          </header>
          <div class="db-select-wrapper">
            <label for="db-select" class="db-select-label" data-i18n="vocab.database.selectFile">Ch·ªçn file t·ª´ v·ª±ng:</label>
            <select id="db-list" class="db-select"></select>
          </div>
        </section>

        <section class="card table-card">
          <header class="card__header table-card__header">
            <h2 id="word-table-title" data-i18n="vocab.words.title">Danh s√°ch t·ª´</h2>
          </header>
          <div class="table-wrapper">
            <table id="word-table">
              <thead>
                <tr>
                  <th data-i18n="vocab.words.columns.word">T·ª´</th>
                  <th data-i18n="vocab.words.columns.ipa">IPA</th>
                  <th data-i18n="vocab.words.columns.type">Lo·∫°i t·ª´</th>
                  <th data-i18n="vocab.words.columns.cefr">CEFR</th>
                  <th data-i18n="vocab.words.columns.definition">ƒê·ªãnh nghƒ©a</th>
                  <th data-i18n="vocab.words.columns.example">V√≠ d·ª•</th>
                  <th data-i18n="vocab.words.columns.notes">Ghi ch√∫</th>
                  <th data-i18n="vocab.words.columns.tags">Tags</th>
                  <th data-i18n="vocab.words.columns.actions">H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="word-table-body"></tbody>
            </table>
            <div id="table-empty" class="table-empty muted" data-i18n="vocab.words.empty">
              Ch∆∞a c√≥ d·ªØ li·ªáu trong database n√†y.
            </div>
          </div>
        </section>
      </section>
        </div>
      </div>

      <div class="tab-content" data-tab="scoring">
        <div class="scoring-container">
          <section class="card scoring-input-card">
            <header class="card__header">
              <h2 data-i18n="scoring.input.title">Nh·∫≠p c√¢u ƒë·ªÉ ch·∫•m ƒëi·ªÉm</h2>
              <p class="card__subtitle" data-i18n="scoring.input.subtitle">AI s·∫Ω ph√¢n t√≠ch ng·ªØ ph√°p, t·ª´ v·ª±ng v√† ƒë∆∞a ra ƒëi·ªÉm s·ªë chi ti·∫øt</p>
            </header>
            <div class="scoring-input-area">
              <div class="textarea-wrapper">
                <textarea
                  id="sentence-input"
                  placeholder="Nh·∫≠p c√¢u ti·∫øng Anh c·ªßa b·∫°n ƒë·ªÉ ƒë∆∞·ª£c ch·∫•m ƒëi·ªÉm v√† ph√¢n t√≠ch..."
                  rows="4"
                ></textarea>
                <div class="textarea-footer">
                  <span class="char-counter">
                    <span id="char-count">0</span> k√Ω t·ª±
                  </span>
                  <span class="kbd-hint">
                    <kbd>Ctrl</kbd> + <kbd>Enter</kbd> to submit
                  </span>
                </div>
              </div>
              <button id="score-btn" type="button" class="primary-btn">
                <span>Ch·∫•m ƒëi·ªÉm</span>
              </button>
            </div>
          </section>

          <section class="card scoring-result-card">
            <header class="card__header">
              <h2 data-i18n="scoring.result.title">K·∫øt qu·∫£ ch·∫•m ƒëi·ªÉm</h2>
            </header>
            <div id="scoring-output" class="scoring-output">
              <p class="muted" data-i18n="scoring.result.empty">Ch∆∞a c√≥ k·∫øt qu·∫£. H√£y nh·∫≠p c√¢u v√† nh·∫•n "Ch·∫•m ƒëi·ªÉm".</p>
            </div>
          </section>
        </div>
      </div>

      <!-- Profile & Streaks Tab -->
      <div class="tab-content" data-tab="profile">
        <div class="profile-layout">
          <!-- Stats Row -->
          <div class="stats-row" role="group" aria-label="Summary statistics">
            <div class="stat-card" title="Total words you've collected">
              <div class="stat-icon">üìö</div>
              <div class="stat-content">
                <div class="stat-value" id="total-words">0</div>
                <div class="stat-label">Total Words</div>
              </div>
            </div>
            <div class="stat-card" title="Current learning streak">
              <div class="stat-icon">üî•</div>
              <div class="stat-content">
                <div class="stat-value" id="current-streak">0</div>
                <div class="stat-label">Day Streak</div>
              </div>
            </div>
            <div class="stat-card" title="Longest streak ever">
              <div class="stat-icon">üèÜ</div>
              <div class="stat-content">
                <div class="stat-value" id="longest-streak">0</div>
                <div class="stat-label">Best Streak</div>
              </div>
            </div>
            <div class="stat-card" title="Achievements unlocked">
              <div class="stat-icon">‚≠ê</div>
              <div class="stat-content">
                <div class="stat-value" id="total-achievements">0</div>
                <div class="stat-label">Achievements</div>
              </div>
            </div>
          </div>

          <!-- Goals -->
          <section class="card goals-card" aria-labelledby="goals-title">
            <header class="card__header">
              <h2 id="goals-title">Learning Goals</h2>
              <p class="card__subtitle">Daily & weekly word targets</p>
            </header>
            <div class="goals-flex">
              <div class="goal-block">
                <div class="goal-head">
                  <span class="goal-name">Daily</span>
                  <span class="goal-value"><span id="daily-progress">0</span>/<span id="daily-goal">5</span></span>
                </div>
                <div class="goal-bar">
                  <div class="goal-fill" id="daily-progress-bar" style="width:0%"></div>
                </div>
              </div>
              <div class="goal-block">
                <div class="goal-head">
                  <span class="goal-name">Weekly</span>
                  <span class="goal-value"><span id="weekly-progress">0</span>/<span id="weekly-goal">30</span></span>
                </div>
                <div class="goal-bar">
                  <div class="goal-fill" id="weekly-progress-bar" style="width:0%"></div>
                </div>
              </div>
              <div class="goal-actions">
                <button id="edit-goals-btn" class="ghost-btn small">Edit Goals</button>
              </div>
            </div>
          </section>

          <!-- Achievements -->
          <section class="card achievements-card" aria-labelledby="achievements-title">
            <header class="card__header">
              <h2 id="achievements-title">Achievements</h2>
              <p class="card__subtitle">Milestones & badges</p>
            </header>
            <div id="achievements-grid" class="achievements-responsive" aria-live="polite"></div>
          </section>

          <!-- Charts Row -->
          <div class="charts-row">
            <section class="card level-card" aria-labelledby="level-chart-title">
              <header class="card__header">
                <h2 id="level-chart-title">CEFR Levels</h2>
                <p class="card__subtitle">Difficulty distribution</p>
              </header>
              <div id="level-chart" class="chart-container"></div>
            </section>
            <section class="card type-card" aria-labelledby="type-chart-title">
              <header class="card__header">
                <h2 id="type-chart-title">Word Types</h2>
                <p class="card__subtitle">Parts of speech</p>
              </header>
              <div id="type-chart" class="chart-container"></div>
            </section>
          </div>

          <!-- Calendar -->
          <section class="card calendar-card" aria-labelledby="calendar-title">
            <header class="card__header card__header--collapsible">
              <div class="header-content">
                <h2 id="calendar-title">Activity Calendar</h2>
                <p class="card__subtitle">Past 3 weeks</p>
              </div>
              <button id="toggle-calendar-btn" class="ghost-btn icon-only small" aria-label="Toggle calendar" title="Expand/Collapse">
                <span class="toggle-icon">‚ñº</span>
              </button>
            </header>
            <div id="calendar-content" class="calendar-content">
              <div id="activity-calendar" class="calendar-grid" aria-live="polite"></div>
              <div class="freeze-actions">
                <button id="use-freeze-btn" class="ghost-btn small">‚ùÑÔ∏è Use Freeze (<span id="freezes-available">2</span>)</button>
              </div>
            </div>
          </section>
        </div>
      </div>
      
      <footer class="app-footer">
        <div class="app-footer-content">
          <img src="../../static/icon.png" alt="Magic English Logo" class="app-footer-logo" />
          <span class="app-footer-name">Magic English</span>
          <span class="app-footer-separator">‚Ä¢</span>
          <span class="app-footer-copyright">¬© 2025 Alphatitan, Inc</span>
        </div>
      </footer>
    </div>

    <div id="toast-container" class="toast-container"></div>
    
    <dialog id="db-modal" class="modal">
      <form method="dialog" class="modal__content">
        <h3 class="modal__title" data-i18n="vocab.database.create.title">T·∫°o database m·ªõi</h3>
        <p class="modal__subtitle" data-i18n="vocab.database.create.subtitle">Nh·∫≠p t√™n file JSON (v√≠ d·ª•: travel.json ho·∫∑c travel)</p>
        <input id="db-modal-input" type="text" data-i18n-placeholder="vocab.database.create.placeholder" placeholder="T√™n database" autofocus />
        <div class="modal__actions">
          <button value="cancel" class="ghost-btn" data-i18n="vocab.database.create.cancel">Hu·ª∑</button>
          <button id="db-modal-confirm" value="confirm" class="primary-btn" data-i18n="vocab.database.create.confirm">T·∫°o</button>
        </div>
      </form>
    </dialog>

    <dialog id="confirm-modal" class="modal">
      <form method="dialog" class="modal__content">
        <h3 class="modal__title" id="confirm-modal-title"></h3>
        <p class="modal__subtitle" id="confirm-modal-message"></p>
        <div class="modal__actions">
          <button value="cancel" class="ghost-btn" data-i18n="modals.cancel">Hu·ª∑</button>
          <button value="confirm" class="primary-btn" id="confirm-modal-confirm" data-i18n="modals.confirm">X√°c nh·∫≠n</button>
        </div>
      </form>
    </dialog>

    <dialog id="prompt-modal" class="modal">
      <form method="dialog" class="modal__content">
        <h3 class="modal__title" id="prompt-modal-title"></h3>
        <p class="modal__subtitle" id="prompt-modal-message"></p>
        <input id="prompt-modal-input" type="text" placeholder="" autofocus />
        <div class="modal__actions">
          <button value="cancel" class="ghost-btn" data-i18n="modals.cancel">Hu·ª∑</button>
          <button value="confirm" class="primary-btn" id="prompt-modal-confirm" data-i18n="modals.confirm">X√°c nh·∫≠n</button>
        </div>
      </form>
    </dialog>

    <dialog id="goals-modal" class="modal">
      <form method="dialog" class="modal__content">
        <h3 class="modal__title">Edit Learning Goals</h3>
        <p class="modal__subtitle">Set your daily and weekly word targets</p>
        <div style="display: flex; flex-direction: column; gap: 16px;">
          <div>
            <label for="goals-daily-input" style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 6px;">Daily Goal (words/day)</label>
            <input id="goals-daily-input" type="number" min="1" placeholder="5" style="width: 100%;" />
          </div>
          <div>
            <label for="goals-weekly-input" style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 6px;">Weekly Goal (words/week)</label>
            <input id="goals-weekly-input" type="number" min="1" placeholder="30" style="width: 100%;" />
          </div>
        </div>
        <div class="modal__actions">
          <button type="button" value="cancel" class="ghost-btn">Cancel</button>
          <button type="button" value="confirm" class="primary-btn" id="goals-modal-confirm">Save Goals</button>
        </div>
      </form>
    </dialog>

    <dialog id="settings-modal" class="modal settings-modal">
      <form method="dialog" class="modal__content">
        <h3 class="modal__title" data-i18n="settings.title">C√†i ƒë·∫∑t</h3>
        
        <div class="settings-sections">
          <section class="settings-section">
            <label class="settings-label">
              <span class="settings-label-text" data-i18n="settings.theme.title">Giao di·ªán</span>
              <select id="theme-select" class="settings-select">
                <option value="system" selected>üñ•Ô∏è Theo h·ªá th·ªëng</option>
                <option value="light" data-i18n="settings.theme.light">‚òÄÔ∏è S√°ng</option>
                <option value="dark" data-i18n="settings.theme.dark">üåô T·ªëi</option>
              </select>
            </label>
          </section>

          <section class="settings-section">
            <label class="settings-label">
              <span class="settings-label-text" data-i18n="settings.language.title">Ng√¥n ng·ªØ</span>
              <select id="language-select" class="settings-select">
                <option value="en" data-i18n="settings.language.english">üá¨üáß English</option>
                <option value="vi" data-i18n="settings.language.vietnamese">üáªüá≥ Ti·∫øng Vi·ªát</option>
              </select>
            </label>
          </section>

          <!-- AI Provider Settings -->
          <section class="settings-section ai-settings-section">
            <div class="settings-section-header">
              <h4 class="settings-section-title">AI Provider Configuration</h4>
            </div>
            
            <p class="settings-description">Choose your AI provider and configure the connection settings.</p>

            <!-- Provider Selection -->
            <label class="settings-label">
              <span class="settings-label-text">AI Provider</span>
              <select id="ai-provider-select" class="settings-select">
                <option value="ollama-cloud">‚òÅÔ∏è Ollama Cloud</option>
                <option value="ollama-local">üè† Ollama Local</option>
                <option value="openai">ü§ñ OpenAI</option>
              </select>
            </label>

            <!-- Ollama Cloud Settings -->
            <div id="ollama-cloud-settings" class="provider-settings">
              <div class="provider-header">
                <img src="../../static/ollama-logo.svg" alt="Ollama" class="ai-provider-logo" />
                <span class="provider-title">Ollama Cloud</span>
              </div>
              <p class="provider-description">Get your free API key at <a href="https://ollama.com" target="_blank">ollama.com</a></p>
              
              <label class="settings-label">
                <span class="settings-label-text">API Key</span>
                <input id="ollama-cloud-api-key" type="password" class="settings-input" placeholder="Enter your Ollama Cloud API key" />
                <button type="button" id="toggle-ollama-api-key" class="toggle-password-btn" title="Show/Hide">üëÅÔ∏è</button>
              </label>
              
              <label class="settings-label">
                <span class="settings-label-text">Model</span>
                <select id="ollama-cloud-model" class="settings-select">
                  <option value="qwen3-coder:480b-cloud">Qwen3 Coder 480B (Cloud)</option>
                  <option value="gpt-oss:120b-cloud">GPT OSS 120B (Cloud)</option>
                  <option value="gpt-oss:20b-cloud" selected>GPT OSS 20B (Cloud) - Recommended</option>
                  <option value="deepseek-v3.1:671b-cloud">DeepSeek v3.1 671B (Cloud)</option>
                </select>
              </label>
              
              <button type="button" id="test-ollama-cloud" class="secondary-btn test-connection-btn">
                <span class="btn-icon">üîå</span>
                <span>Test Connection</span>
              </button>
            </div>

            <!-- Ollama Local Settings -->
            <div id="ollama-local-settings" class="provider-settings" style="display: none;">
              <div class="provider-header">
                <img src="../../static/ollama-logo.svg" alt="Ollama" class="ai-provider-logo" />
                <span class="provider-title">Ollama Local</span>
              </div>
              <p class="provider-description">Connect to your local Ollama server. <a href="https://ollama.com" target="_blank">Install Ollama</a> to get started.</p>
              
              <label class="settings-label">
                <span class="settings-label-text">Server URL</span>
                <input id="ollama-local-host" type="text" class="settings-input" placeholder="http://localhost:11434" />
              </label>
              
              <label class="settings-label">
                <span class="settings-label-text">Model</span>
                <input id="ollama-local-model" type="text" class="settings-input" placeholder="llama3.2:latest" />
              </label>
              
              <button type="button" id="test-ollama-local" class="secondary-btn test-connection-btn">
                <span class="btn-icon">üîå</span>
                <span>Test Connection</span>
              </button>
            </div>

            <!-- OpenAI Settings -->
            <div id="openai-settings" class="provider-settings" style="display: none;">
              <div class="provider-header">
                <span class="provider-title">OpenAI / OpenAI-Compatible</span>
              </div>
              <p class="provider-description">Use OpenAI API or compatible local servers (vLLM, LocalAI, etc.). Get official API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></p>
              
              <label class="settings-label">
                <span class="settings-label-text">API Endpoint</span>
                <input id="openai-endpoint" type="text" class="settings-input" placeholder="https://api.openai.com" />
              </label>
              
              <label class="settings-label">
                <span class="settings-label-text">API Key</span>
                <input id="openai-api-key" type="password" class="settings-input" placeholder="Enter your API key (or any value for local servers)" />
                <button type="button" id="toggle-openai-api-key" class="toggle-password-btn" title="Show/Hide">üëÅÔ∏è</button>
              </label>
              
              <label class="settings-label">
                <span class="settings-label-text">Model</span>
                <input id="openai-model" type="text" class="settings-input" placeholder="gpt-4o-mini" />
              </label>
              
              <button type="button" id="test-openai" class="secondary-btn test-connection-btn">
                <span class="btn-icon">üîå</span>
                <span>Test Connection</span>
              </button>
            </div>
          </section>
        </div>

        <div class="modal__actions">
          <button value="cancel" class="ghost-btn" data-i18n="settings.close">ƒê√≥ng</button>
          <button type="button" id="save-ai-settings" class="primary-btn">Save Settings</button>
        </div>
        
        <!-- Toast container inside modal for top-layer visibility -->
        <div class="modal-toast-container"></div>
      </form>
    </dialog>
    <script type="module" src="./app.js"></script>
  </body>
</html>

